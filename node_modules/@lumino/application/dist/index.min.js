!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@lumino/commands"),require("@lumino/coreutils"),require("@lumino/widgets")):"function"==typeof define&&define.amd?define(["exports","@lumino/commands","@lumino/coreutils","@lumino/widgets"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).lumino_application={},t.lumino_commands,t.lumino_coreutils,t.lumino_widgets)}(this,(function(t,e,n,i){"use strict";var r,o,s,l;!function(t){function e(t,e,n=0,i=-1){let r,o=t.length;if(0===o)return-1;n=n<0?Math.max(0,n+o):Math.min(n,o-1),r=(i=i<0?Math.max(0,i+o):Math.min(i,o-1))<n?i+1+(o-n):i-n+1;for(let i=0;i<r;++i){let r=(n+i)%o;if(t[r]===e)return r}return-1}function n(t,e,n=-1,i=0){let r,o=t.length;if(0===o)return-1;r=(n=n<0?Math.max(0,n+o):Math.min(n,o-1))<(i=i<0?Math.max(0,i+o):Math.min(i,o-1))?n+1+(o-i):n-i+1;for(let i=0;i<r;++i){let r=(n-i+o)%o;if(t[r]===e)return r}return-1}function i(t,e,n=0,i=-1){let r,o=t.length;if(0===o)return-1;n=n<0?Math.max(0,n+o):Math.min(n,o-1),r=(i=i<0?Math.max(0,i+o):Math.min(i,o-1))<n?i+1+(o-n):i-n+1;for(let i=0;i<r;++i){let r=(n+i)%o;if(e(t[r],r))return r}return-1}function r(t,e,n=-1,i=0){let r,o=t.length;if(0===o)return-1;r=(n=n<0?Math.max(0,n+o):Math.min(n,o-1))<(i=i<0?Math.max(0,i+o):Math.min(i,o-1))?n+1+(o-i):n-i+1;for(let i=0;i<r;++i){let r=(n-i+o)%o;if(e(t[r],r))return r}return-1}function o(t,e=0,n=-1){let i=t.length;if(!(i<=1))for(e=e<0?Math.max(0,e+i):Math.min(e,i-1),n=n<0?Math.max(0,n+i):Math.min(n,i-1);e<n;){let i=t[e],r=t[n];t[e++]=r,t[n--]=i}}function s(t,e){let n=t.length;if(e<0&&(e+=n),e<0||e>=n)return;let i=t[e];for(let i=e+1;i<n;++i)t[i-1]=t[i];return t.length=n-1,i}t.firstIndexOf=e,t.lastIndexOf=n,t.findFirstIndex=i,t.findLastIndex=r,t.findFirstValue=function(t,e,n=0,r=-1){let o=i(t,e,n,r);return-1!==o?t[o]:void 0},t.findLastValue=function(t,e,n=-1,i=0){let o=r(t,e,n,i);return-1!==o?t[o]:void 0},t.lowerBound=function(t,e,n,i=0,r=-1){let o=t.length;if(0===o)return 0;let s=i=i<0?Math.max(0,i+o):Math.min(i,o-1),l=(r=r<0?Math.max(0,r+o):Math.min(r,o-1))-i+1;for(;l>0;){let i=l>>1,r=s+i;n(t[r],e)<0?(s=r+1,l-=i+1):l=i}return s},t.upperBound=function(t,e,n,i=0,r=-1){let o=t.length;if(0===o)return 0;let s=i=i<0?Math.max(0,i+o):Math.min(i,o-1),l=(r=r<0?Math.max(0,r+o):Math.min(r,o-1))-i+1;for(;l>0;){let i=l>>1,r=s+i;n(t[r],e)>0?l=i:(s=r+1,l-=i+1)}return s},t.shallowEqual=function(t,e,n){if(t===e)return!0;if(t.length!==e.length)return!1;for(let i=0,r=t.length;i<r;++i)if(n?!n(t[i],e[i]):t[i]!==e[i])return!1;return!0},t.slice=function(t,e={}){let{start:n,stop:i,step:r}=e;if(void 0===r&&(r=1),0===r)throw new Error("Slice `step` cannot be zero.");let o,s=t.length;void 0===n?n=r<0?s-1:0:n<0?n=Math.max(n+s,r<0?-1:0):n>=s&&(n=r<0?s-1:s),void 0===i?i=r<0?-1:s:i<0?i=Math.max(i+s,r<0?-1:0):i>=s&&(i=r<0?s-1:s),o=r<0&&i>=n||r>0&&n>=i?0:r<0?Math.floor((i-n+1)/r+1):Math.floor((i-n-1)/r+1);let l=[];for(let e=0;e<o;++e)l[e]=t[n+e*r];return l},t.move=function(t,e,n){let i=t.length;if(i<=1)return;if((e=e<0?Math.max(0,e+i):Math.min(e,i-1))===(n=n<0?Math.max(0,n+i):Math.min(n,i-1)))return;let r=t[e],o=e<n?1:-1;for(let i=e;i!==n;i+=o)t[i]=t[i+o];t[n]=r},t.reverse=o,t.rotate=function(t,e,n=0,i=-1){let r=t.length;if(r<=1)return;if((n=n<0?Math.max(0,n+r):Math.min(n,r-1))>=(i=i<0?Math.max(0,i+r):Math.min(i,r-1)))return;let s=i-n+1;if(e>0?e%=s:e<0&&(e=(e%s+s)%s),0===e)return;let l=n+e;o(t,n,l-1),o(t,l,i),o(t,n,i)},t.fill=function(t,e,n=0,i=-1){let r,o=t.length;if(0!==o){n=n<0?Math.max(0,n+o):Math.min(n,o-1),r=(i=i<0?Math.max(0,i+o):Math.min(i,o-1))<n?i+1+(o-n):i-n+1;for(let i=0;i<r;++i)t[(n+i)%o]=e}},t.insert=function(t,e,n){let i=t.length;e=e<0?Math.max(0,e+i):Math.min(e,i);for(let n=i;n>e;--n)t[n]=t[n-1];t[e]=n},t.removeAt=s,t.removeFirstOf=function(t,n,i=0,r=-1){let o=e(t,n,i,r);return-1!==o&&s(t,o),o},t.removeLastOf=function(t,e,i=-1,r=0){let o=n(t,e,i,r);return-1!==o&&s(t,o),o},t.removeAllOf=function(t,e,n=0,i=-1){let r=t.length;if(0===r)return 0;n=n<0?Math.max(0,n+r):Math.min(n,r-1),i=i<0?Math.max(0,i+r):Math.min(i,r-1);let o=0;for(let s=0;s<r;++s)n<=i&&s>=n&&s<=i&&t[s]===e||i<n&&(s<=i||s>=n)&&t[s]===e?o++:o>0&&(t[s-o]=t[s]);return o>0&&(t.length=r-o),o},t.removeFirstWhere=function(t,e,n=0,r=-1){let o,l=i(t,e,n,r);return-1!==l&&(o=s(t,l)),{index:l,value:o}},t.removeLastWhere=function(t,e,n=-1,i=0){let o,l=r(t,e,n,i);return-1!==l&&(o=s(t,l)),{index:l,value:o}},t.removeAllWhere=function(t,e,n=0,i=-1){let r=t.length;if(0===r)return 0;n=n<0?Math.max(0,n+r):Math.min(n,r-1),i=i<0?Math.max(0,i+r):Math.min(i,r-1);let o=0;for(let s=0;s<r;++s)n<=i&&s>=n&&s<=i&&e(t[s],s)||i<n&&(s<=i||s>=n)&&e(t[s],s)?o++:o>0&&(t[s-o]=t[s]);return o>0&&(t.length=r-o),o}}(r||(r={})),function(t){t.rangeLength=function(t,e,n){return 0===n?1/0:t>e&&n>0||t<e&&n<0?0:Math.ceil((e-t)/n)}}(o||(o={})),function(t){function e(t,e,n=0){let i=new Array(e.length);for(let r=0,o=n,s=e.length;r<s;++r,++o){if(o=t.indexOf(e[r],o),-1===o)return null;i[r]=o}return i}t.findIndices=e,t.matchSumOfSquares=function(t,n,i=0){let r=e(t,n,i);if(!r)return null;let o=0;for(let t=0,e=r.length;t<e;++t){let e=r[t]-i;o+=e*e}return{score:o,indices:r}},t.matchSumOfDeltas=function(t,n,i=0){let r=e(t,n,i);if(!r)return null;let o=0,s=i-1;for(let t=0,e=r.length;t<e;++t){let e=r[t];o+=e-s-1,s=e}return{score:o,indices:r}},t.highlight=function(t,e,n){let i=[],r=0,o=0,s=e.length;for(;r<s;){let l=e[r],a=e[r];for(;++r<s&&e[r]===a+1;)a++;o<l&&i.push(t.slice(o,l)),l<a+1&&i.push(n(t.slice(l,a+1))),o=a+1}return o<t.length&&i.push(t.slice(o)),i},t.cmp=function(t,e){return t<e?-1:t>e?1:0}}(s||(s={}));!function(t){t.createPluginData=function(t){var e,n,i,r;return{id:t.id,description:null!==(e=t.description)&&void 0!==e?e:"",service:null,promise:null,activated:!1,activate:t.activate,deactivate:null!==(n=t.deactivate)&&void 0!==n?n:null,provides:null!==(i=t.provides)&&void 0!==i?i:null,autoStart:null!==(r=t.autoStart)&&void 0!==r&&r,requires:t.requires?t.requires.slice():[],optional:t.optional?t.optional.slice():[]}},t.ensureNoCycle=function(t,e,n){const i=[...t.requires,...t.optional],r=i=>{if(i===t.provides)return!0;const s=n.get(i);if(!s)return!1;const l=e.get(s),a=[...l.requires,...l.optional];return 0!==a.length&&(o.push(s),!!a.some(r)||(o.pop(),!1))};if(!t.provides||0===i.length)return;const o=[t.id];if(i.some(r))throw new ReferenceError(`Cycle detected: ${o.join(" -> ")}.`)},t.findDependents=function(t,e,n){const i=new Array,r=t=>{const r=e.get(t),o=[...r.requires,...r.optional];i.push(...o.reduce(((e,i)=>{const r=n.get(i);return r&&e.push([t,r]),e}),[]))};for(const t of e.keys())r(t);const o=i.filter((e=>e[1]===t));let s=0;for(;o.length>s;){const t=o.length,e=new Set(o.map((t=>t[0])));for(const t of e)i.filter((e=>e[1]===t)).forEach((t=>{o.includes(t)||o.push(t)}));s=t}const l=function(t){let e=[],n=new Set,i=new Map;for(const e of t)r(e);for(const[t]of i)o(t);return e;function r(t){let[e,n]=t,r=i.get(n);r?r.push(e):i.set(n,[e])}function o(t){if(n.has(t))return;n.add(t);let r=i.get(t);if(r)for(const t of r)o(t);e.push(t)}}(o),a=l.findIndex((e=>e===t));return-1===a?[t]:l.slice(0,a+1)},t.collectStartupPlugins=function(t,e){const n=new Map;for(const e of t.keys())t.get(e).autoStart&&n.set(e,!0);if(e.startPlugins)for(const t of e.startPlugins)n.set(t,!0);if(e.ignorePlugins)for(const t of e.ignorePlugins)n.delete(t);return Array.from(n.keys())}}(l||(l={})),t.Application=class{constructor(t){this._delegate=new n.PromiseDelegate,this._plugins=new Map,this._services=new Map,this._started=!1,this.commands=new e.CommandRegistry,this.contextMenu=new i.ContextMenu({commands:this.commands,renderer:t.contextMenuRenderer}),this.shell=t.shell}get started(){return this._delegate.promise}getPluginDescription(t){var e,n;return null!==(n=null===(e=this._plugins.get(t))||void 0===e?void 0:e.description)&&void 0!==n?n:""}hasPlugin(t){return this._plugins.has(t)}isPluginActivated(t){var e,n;return null!==(n=null===(e=this._plugins.get(t))||void 0===e?void 0:e.activated)&&void 0!==n&&n}listPlugins(){return Array.from(this._plugins.keys())}registerPlugin(t){if(this._plugins.has(t.id))throw new TypeError(`Plugin '${t.id}' is already registered.`);const e=l.createPluginData(t);l.ensureNoCycle(e,this._plugins,this._services),e.provides&&this._services.set(e.provides,e.id),this._plugins.set(e.id,e)}registerPlugins(t){for(const e of t)this.registerPlugin(e)}deregisterPlugin(t,e){const n=this._plugins.get(t);if(n){if(n.activated&&!e)throw new Error(`Plugin '${t}' is still active.`);this._plugins.delete(t)}}async activatePlugin(t){const e=this._plugins.get(t);if(!e)throw new ReferenceError(`Plugin '${t}' is not registered.`);if(e.activated)return;if(e.promise)return e.promise;const n=e.requires.map((t=>this.resolveRequiredService(t))),i=e.optional.map((t=>this.resolveOptionalService(t)));return e.promise=Promise.all([...n,...i]).then((t=>e.activate.apply(void 0,[this,...t]))).then((t=>{e.service=t,e.activated=!0,e.promise=null})).catch((t=>{throw e.promise=null,t})),e.promise}async deactivatePlugin(t){const e=this._plugins.get(t);if(!e)throw new ReferenceError(`Plugin '${t}' is not registered.`);if(!e.activated)return[];if(!e.deactivate)throw new TypeError(`Plugin '${t}'#deactivate() method missing`);const n=l.findDependents(t,this._plugins,this._services),i=n.map((t=>this._plugins.get(t)));for(const e of i)if(!e.deactivate)throw new TypeError(`Plugin ${e.id}#deactivate() method missing (depends on ${t})`);for(const t of i){const e=[...t.requires,...t.optional].map((t=>{const e=this._services.get(t);return e?this._plugins.get(e).service:null}));await t.deactivate(this,...e),t.service=null,t.activated=!1}return n.pop(),n}async resolveRequiredService(t){const e=this._services.get(t);if(!e)throw new TypeError(`No provider for: ${t.name}.`);const n=this._plugins.get(e);return n.activated||await this.activatePlugin(e),n.service}async resolveOptionalService(t){const e=this._services.get(t);if(!e)return null;const n=this._plugins.get(e);if(!n.activated)try{await this.activatePlugin(e)}catch(t){return console.error(t),null}return n.service}start(t={}){if(this._started)return this._delegate.promise;this._started=!0;const e=t.hostID||"",n=l.collectStartupPlugins(this._plugins,t).map((t=>this.activatePlugin(t).catch((e=>{console.error(`Plugin '${t}' failed to activate.`),console.error(e)}))));return Promise.all(n).then((()=>{this.attachShell(e),this.addEventListeners(),this._delegate.resolve()})),this._delegate.promise}handleEvent(t){switch(t.type){case"resize":this.evtResize(t);break;case"keydown":this.evtKeydown(t);break;case"contextmenu":this.evtContextMenu(t)}}attachShell(t){i.Widget.attach(this.shell,t&&document.getElementById(t)||document.body)}addEventListeners(){document.addEventListener("contextmenu",this),document.addEventListener("keydown",this,!0),window.addEventListener("resize",this)}evtKeydown(t){this.commands.processKeydownEvent(t)}evtContextMenu(t){t.shiftKey||this.contextMenu.open(t)&&(t.preventDefault(),t.stopPropagation())}evtResize(t){this.shell.update()}}}));
//# sourceMappingURL=index.min.js.map